name: GitHub Admin Tool

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'Action to perform'
        required: true
        type: choice
        options:
          - create-team
          - delete-team
          - add-repo
          - remove-repo
          - add-user
          - remove-user
          - create-repo
          - user-access
          - list-orgs 
          - list-teams
          - list-repos
          - list-users 
          - list-users-access 

      org:
        description: 'GitHub Organization (required for most actions)'
        required: false 
        type: string 
        
      team:
        description: 'Team name (if applicable)'
        required: false
        type: string

      repo:
        description: 'Repository name (if applicable)'
        required: false 
        type: string 
        
      user:
        description: 'GitHub username OR email address (e.g., "octocat" or "user@example.com")'
        required: false
        type: string 

      permission:
        description: 'Permission level (if applicable)'
        required: false
        type: choice
        options:
          - nil 
          - pull
          - triage
          - push
          - maintain
          - admin

      repo_name:
        description: 'New repo name (for create-repo)'
        required: false
        type: string

      repo_private:
        description: 'Should repo be private? (for create-repo)'
        required: false
        type: boolean 
        default: 

jobs:
  github-admin:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5 
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run GitHub Admin Script
        env:
          TOKEN: ${{ secrets.GITHUB_ADMIN_TOKEN }} 
          ACTION: ${{ github.event.inputs.action }}
          ORG: ${{ github.event.inputs.org }}
          TEAM: ${{ github.event.inputs.team }}
          REPO: ${{ github.event.inputs.repo }}
          USER: ${{ github.event.inputs.user }} 
          PERMISSION: ${{ github.event.inputs.permission }}
          REPO_NAME: ${{ github.event.inputs.repo_name }}
          REPO_PRIVATE: ${{ github.event.inputs.repo_private }} 

        run: |
          
          ARGS="--action \"$ACTION\""
          
          
            ARGS="$ARGS --org \"$ORG\""
          fi

          if [[ -n "$TEAM" ]]; then
            ARGS="$ARGS --team \"$TEAM\""
          fi
          
          if [[ -n "$REPO" ]]; then
            ARGS="$ARGS --repo \"$REPO\""
          fi

          if [[ -n "$USER" ]]; then
            ARGS="$ARGS --user \"$USER\""
          fi

          if [[ "$PERMISSION" != "nil" && -n "$PERMISSION" ]]; then
            ARGS="$ARGS --permission \"$PERMISSION\""
          fi

          if [[ -n "$REPO_NAME" ]]; then
            ARGS="$ARGS --repo-name \"$REPO_NAME\""
          fi

          if [[ "$REPO_PRIVATE" == "true" ]]; then
            ARGS="$ARGS --repo-private"
          fi

          echo "â–¶ Running script: python3 git-manager.py $ARGS"
          python3 git-manager.py $ARGS
